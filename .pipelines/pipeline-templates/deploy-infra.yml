  parameters:
  - name: templateFilePath
    type: string
  - name: templateParameterFilePath
    type: string
  - name: appName
    type: string
  
  jobs:

  # - deployment: DeployARM
  #   dependsOn: CreateResourceGroup
  #   displayName: Deploy ARM template
  #   condition: succeeded()
  #   environment: dev
  #   variables:
  #   - group: Release
  #   strategy:
  #     runOnce:
  #       deploy:
  #         steps:
  #         - download: current
  #           displayName: Download template
  #         - task: AzureResourceManagerTemplateDeployment@3
  #           displayName: Deploy ARM Template
  #           inputs:
  #             connectedServiceName: $(ServiceConnectionName)
  #             deploymentName: $(Build.BuildNumber)
  #             location: $(deploymentDefaultLocation)
  #             resourceGroupName: $(ResourceGroupName)
  #             csmFile: $(Pipeline.Workspace)/Bicep/main.json
  #             csmParametersFile: ${{ parameters.templateParameterFilePath }}
  #             overrideParameters: -appName $(appName)

  - deployment: DeployARM
    dependsOn: CreateResourceGroup
    displayName: Deploy ARM template
    condition: succeeded()
    environment: dev
    variables:
    - group: Release
    strategy:
      runOnce:
        deploy:
          steps:
          - download: current
            displayName: Download template
          - task: AzurePowerShell@5
            displayName: Deploy ARM Template
            inputs:
              azureSubscription: $(ServiceConnectionName)
              pwsh: false
              azurePowerShellVersion: 'LatestVersion'
              ScriptType: 'FilePath'
              ScriptPath: '$(Build.SourcesDirectory)/scripts/DeployBicepTemplate.ps1'
              ScriptArguments:
                -ResourceGroupName "$(ResourceGroupName)" `
                -Location "$(deploymentDefaultLocation)" `
                -TemplateFile  "${{ parameters.templateFilePath }}" `
                -TemplateParameterFile "${{ parameters.templateParameterFilePath }}"