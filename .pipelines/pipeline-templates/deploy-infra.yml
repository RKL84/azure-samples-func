  parameters:
  - name: templateFilePath
    type: string
  - name: templateParameterFilePath
    type: string
  - name: appName
    type: string
  
  jobs:

  - deployment: DeployARM
    dependsOn: CreateResourceGroup
    displayName: Deploy ARM template
    condition: succeeded()
    environment: dev
    variables:
    - group: Release
    strategy:
      runOnce:
        deploy:
          steps:
          - download: current
          - task: AzureResourceManagerTemplateDeployment@3
            displayName: Deploy ARM Template
            inputs:
              connectedServiceName: $(ServiceConnectionName)
              deploymentName: $(Build.BuildNumber)
              location: $(deploymentDefaultLocation)
              resourceGroupName: $(ResourceGroupName)
              csmFile: ${{ parameters.templateFilePath }}
              csmParametersFile: ${{ parameters.templateParameterFilePath }}
              overrideParameters: -appName $(appName)