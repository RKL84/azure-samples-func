  jobs:
  - job: Validate
    steps:

      - task: AzureCLI@2
        name: BuildBicepModule
        displayName: Build Bicep
        inputs:
          azureSubscription: $(ServiceConnectionName)
          scriptType: 'bash'
          scriptLocation: 'inlineScript'
          inlineScript: |
            az bicep restore --file deploy/main.bicep
            az bicep build --file deploy/main.bicep

      - task: AzureResourceManagerTemplateDeployment@3
        name: RunPreflightValidation
        displayName: Run preflight validation
        inputs:
          connectedServiceName: $(ServiceConnectionName)
          location: $(deploymentDefaultLocation)
          deploymentMode: Validation
          resourceGroupName: $(ResourceGroupName)
          csmFile: deploy/main.bicep
          csmParametersFile: deploy/parameters.dev.json
          overrideParameters: -appName $(appName)
