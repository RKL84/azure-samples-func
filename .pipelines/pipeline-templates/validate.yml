  jobs:
  - job: Validate
    steps:
      - script: |
          az bicep restore --file deploy/main.bicep
          az bicep build --file deploy/main.bicep
        name: BuildBicepModule
        displayName: Run Bicep linter

      - task: AzureResourceManagerTemplateDeployment@3
        name: RunPreflightValidation
        displayName: Run preflight validation
        inputs:
          connectedServiceName: $(ServiceConnectionName)
          location: $(deploymentDefaultLocation)
          deploymentMode: Validation
          resourceGroupName: $(ResourceGroupName)
          csmFile: deploy/main.bicep
          csmParametersFile: deploy/parameters.dev.json
          overrideParameters: -appName $(appName)
